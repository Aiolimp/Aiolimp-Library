### ä¸ºä»€ä¹ˆè¦æ•è·å¼‚å¸¸

é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿›è¡Œå¼‚å¸¸æ•è·å’Œä¸ŠæŠ¥å‘¢ï¼Ÿ

æ­£æ‰€è°“ç™¾å¯†ä¸€ç–ï¼Œç”¨ç¨‹åºå‘˜çš„è¯æ¥è¯´å°±æ˜¯ï¼šå¤©ä¸‹ä¸å­˜åœ¨æ²¡æœ‰bugçš„ç¨‹åºï¼ˆä¸æ¥å—åé©³ ğŸ¤ ï¼‰ã€‚å³ä½¿ç»è¿‡å„ç§æµ‹è¯•ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ååˆ†éšè”½çš„bugï¼Œè¿™ç§ä¸å¯é¢„è§çš„é—®é¢˜åªæœ‰é€šè¿‡å®Œå–„çš„ç›‘æ§æœºåˆ¶æ‰èƒ½æœ‰æ•ˆçš„å‡å°‘å…¶å¸¦æ¥çš„æŸå¤±ã€‚å› æ­¤ï¼Œå¯¹äºæœ€æ¥è¿‘ç”¨æˆ·çš„å‰ç«¯æ¥è¯´ï¼Œä¸ºäº†èƒ½è¿œç¨‹å®šä½é—®é¢˜ã€å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œå¼‚å¸¸çš„æ•è·å’Œä¸ŠæŠ¥è‡³å…³é‡è¦ã€‚

ç›®å‰å¸‚é¢ä¸Šå·²ç»æœ‰ä¸€äº›éå¸¸å®Œå–„çš„å‰ç«¯ç›‘æ§ç³»ç»Ÿå­˜åœ¨ï¼Œå¦‚Fundebugã€Bugsnagç­‰ï¼Œè™½ç„¶è¿™äº›å·²ç»èƒ½åšåˆ°å¸®æˆ‘ä»¬å®æ—¶ç›‘æ§ç”Ÿäº§ç¯å¢ƒçš„å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸äº†è§£å¼‚å¸¸æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œåˆæ€ä¹ˆèƒ½å¾—å¿ƒåº”æ‰‹çš„å®šä½å¹¶å¤„ç†é—®é¢˜å‘¢ï¼Ÿ

å¯¹äºJSè€Œè¨€ï¼Œæˆ‘ä»¬é¢å¯¹çš„ä»…ä»…åªæ˜¯å¼‚å¸¸ï¼Œå¼‚å¸¸çš„å‡ºç°ä¸ä¼šç›´æ¥å¯¼è‡´JSå¼•æ“å´©æºƒï¼Œæœ€å¤šåªæ˜¯ç»ˆæ­¢å½“å‰ä»£ç çš„æ‰§è¡Œã€‚ä¸‹é¢æ¥è§£é‡Šä¸€ä¸‹è¿™å¥è¯ï¼š

```js
<script>
  error // æ²¡å®šä¹‰è¿‡çš„å˜é‡ï¼Œæ­¤å¤„ä¼šæŠ¥é”™
  console.log('æ°¸è¿œä¸ä¼šæ‰§è¡Œ');
</script>
<script>
  console.log('æˆ‘ç»§ç»­æ‰§è¡Œ')
</script>
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjThicg6Mq5fOCEAHtKIFP0oat6srj6M7BVUvMNNrmQNGKA40yORdvDXMy0aNTauJGdTSCaoROiaTlA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

### å¼‚å¸¸æ•è·åˆ†ç±»

è¿™é‡Œæˆ‘åšäº†ä¸€ä¸ªè„‘å›¾å½’çº³ä¸€äº›å‰ç«¯å¼‚å¸¸ï¼Œä¸ä¸€å®šå¯¹ï¼Œåªæ˜¯æœ‰ä¸ªå¤§æ¦‚å°è±¡ã€‚å¦‚ä¸‹ï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjThicg6Mq5fOCEAHtKIFP0oV1QFQRtLj3SI45foldW2wre8icrwcRQrkwIPosvXzazRib4bD3QkxYHQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

ä¸‹é¢å°±é’ˆå¯¹ä¸åŒå¼‚å¸¸çš„æ•è·ä¸€ä¸€åˆ†æï¼š

#### try...catch çš„è¯¯åŒº

`try...catch`åªèƒ½æ•è·åˆ°**åŒæ­¥çš„è¿è¡Œæ—¶é”™è¯¯**ï¼Œå¯¹äºè¯­æ³•å’Œå¼‚æ­¥é”™è¯¯æ— èƒ½ä¸ºåŠ›ï¼Œæ•è·ä¸åˆ°ã€‚

1.åŒæ­¥è¿è¡Œæ—¶é”™è¯¯

```js
try {
  let name = 'Jack';
  console.log(nam);
} catch(e) {
  console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',e);
}
```



è¾“å‡ºï¼š

```js
æ•è·åˆ°å¼‚å¸¸ï¼šReferenceError: nam is not defined
    at <anonymous>:3:15
```

2.ä¸èƒ½æ•è·è¯­æ³•é”™è¯¯ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªä»£ç ï¼Œåˆ æ‰ä¸€ä¸ªå•å¼•å·

```js
try {
  let name = 'Jack;
  console.log(nam);
} catch(e) {
  console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',e);
}
```

è¾“å‡ºï¼š

```js
Uncaught SyntaxError: Invalid or unexpected token
```

> è¯­æ³•é”™è¯¯`SyntaxError`ï¼Œä¸ç®¡æ˜¯`window.error`è¿˜æ˜¯`try...catch`éƒ½æ²¡æ³•æ•è·å¼‚å¸¸ã€‚ä½†æ˜¯ä¸ç”¨æ‹…å¿ƒï¼Œåœ¨ä½ å†™å¥½ä»£ç æŒ‰ä¸‹ä¿å­˜é‚£ä¸€åˆ»ï¼Œç¼–è¯‘å™¨ä¼šå¸®ä½ æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œå¦‚æœæœ‰é”™è¯¯æœ‰ä¼šæœ‰ä¸ªå¾ˆæ˜æ˜¾çš„çº¢çº¢çš„æ³¢æµªçº¿ï¼ŒæŠŠé¼ æ ‡ç§»ä¸Šå»å°±èƒ½çœ‹åˆ°æŠ¥é”™ä¿¡æ¯ã€‚å› æ­¤ï¼Œé¢å¯¹`SyntaxError`è¯­æ³•é”™è¯¯ï¼Œä¸€å®šè¦å°å¿ƒå°å¿ƒå†å°å¿ƒ

3.å¼‚æ­¥é”™è¯¯

```js
try {
  setTimeout(() => {
    undefined.map(v => v);
  }, 1000)
} catch(e) {
  console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',e);
}
```

è¾“å‡ºï¼š

```js
Uncaught TypeError: Cannot read property 'map' of undefined
    at setTimeout (<anonymous>:3:11)
```

å¯ä»¥çœ‹åˆ°ï¼Œå¹¶æ²¡æœ‰æ•è·åˆ°å¼‚å¸¸ã€‚

#### window.onerror ä¸æ˜¯ä¸‡èƒ½çš„

å½“JSè¿è¡Œæ—¶é”™è¯¯å‘ç”Ÿæ—¶ï¼Œ`window` ä¼šè§¦å‘ä¸€ä¸ª `ErrorEvent` æ¥å£çš„ `error` äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œ `window.onerror()` ã€‚

```js
/**
* @param {String}  message    é”™è¯¯ä¿¡æ¯
* @param {String}  source    å‡ºé”™æ–‡ä»¶
* @param {Number}  lineno    è¡Œå·
* @param {Number}  colno    åˆ—å·
* @param {Object}  error  Errorå¯¹è±¡ï¼ˆå¯¹è±¡ï¼‰
*/

window.onerror = function(message, source, lineno, colno, error) {
   console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',{message, source, lineno, colno, error});
}
```

1.åŒæ­¥è¿è¡Œæ—¶é”™è¯¯

```js
window.onerror = function(message, source, lineno, colno, error) {
    // messageï¼šé”™è¯¯ä¿¡æ¯ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚
    // sourceï¼šå‘ç”Ÿé”™è¯¯çš„è„šæœ¬URLï¼ˆå­—ç¬¦ä¸²ï¼‰
    // linenoï¼šå‘ç”Ÿé”™è¯¯çš„è¡Œå·ï¼ˆæ•°å­—ï¼‰
    // colnoï¼šå‘ç”Ÿé”™è¯¯çš„åˆ—å·ï¼ˆæ•°å­—ï¼‰
    // errorï¼šErrorå¯¹è±¡ï¼ˆå¯¹è±¡ï¼‰
    console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',{message, source, lineno, colno, error});
}
UndefVar;
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ•è·äº†å¼‚å¸¸ï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjThicg6Mq5fOCEAHtKIFP0o4fCoXF5te446Ktp0aFwXaOxXzE46Sq4V5dzt1aW4CAWlrNDAz3feyw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

2.è¯­æ³•é”™è¯¯

```js

window.onerror = function(message, source, lineno, colno, error) {
 console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',{message, source, lineno, colno, error});
}
let name = 'Jack; // å°‘ä¸ªå•å¼•å·
```

æ§åˆ¶å°æ‰“å°å‡ºäº†è¿™æ ·çš„å¼‚å¸¸ï¼š

```js
Uncaught SyntaxError: Invalid or unexpected token
```

å¯ä»¥çœ‹å‡ºï¼Œå¹¶æ²¡æœ‰æ•è·åˆ°å¼‚å¸¸ã€‚

3.å¼‚æ­¥è¿è¡Œæ—¶é”™è¯¯

```js
window.onerror = function(message, source, lineno, colno, error) {
    console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',{message, source, lineno, colno, error});
}
setTimeout(() => {
    UndefVar;
});
```

åŒæ ·çœ‹åˆ°ï¼Œæˆ‘ä»¬æ•è·äº†å¼‚å¸¸ï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjThicg6Mq5fOCEAHtKIFP0oia14kKd8jqnpUE52pnB96RCEx1ptSVuDMK7J1zmUyqt5l3LQHhg2Pxw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

4.ç½‘ç»œè¯·æ±‚çš„å¼‚å¸¸

```js
<script>
window.onerror = function(message, source, lineno, colno, error) {
    console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',{message, source, lineno, colno, error});
    return true;
}
</script>
<img src="./xxx.png">
```

æˆ‘ä»¬å‘ç°ï¼Œä¸è®ºæ˜¯é™æ€èµ„æºå¼‚å¸¸ï¼Œæˆ–è€…æ¥å£å¼‚å¸¸ï¼Œé”™è¯¯éƒ½æ— æ³•æ•è·åˆ°ã€‚

> æ³¨æ„ï¼š
>
> 1.`window.onerror` å‡½æ•°åªæœ‰åœ¨è¿”å› `true` çš„æ—¶å€™ï¼Œå¼‚å¸¸æ‰ä¸ä¼šå‘ä¸ŠæŠ›å‡ºï¼ˆæµè§ˆå™¨æ¥æ”¶åæŠ¥çº¢ï¼‰ï¼Œå¦åˆ™å³ä½¿æ˜¯çŸ¥é“å¼‚å¸¸çš„å‘ç”Ÿæ§åˆ¶å°è¿˜æ˜¯ä¼šæ˜¾ç¤º `Uncaught Error: xxxxx`
>
> 2.`window.onerror` æœ€å¥½å†™åœ¨æ‰€æœ‰JSè„šæœ¬çš„å‰é¢ï¼Œå¦åˆ™æœ‰å¯èƒ½æ•è·ä¸åˆ°é”™è¯¯
>
> 3.`window.onerror`æ— æ³•æ•è·è¯­æ³•é”™è¯¯

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æ•è·é™æ€èµ„æºåŠ è½½é”™è¯¯å‘¢ï¼Ÿ



#### window.addEventListener

å½“ä¸€é¡¹èµ„æºï¼ˆå¦‚å›¾ç‰‡å’Œè„šæœ¬åŠ è½½å¤±è´¥ï¼‰ï¼ŒåŠ è½½èµ„æºçš„å…ƒç´ ä¼šè§¦å‘ä¸€ä¸ª`Event`æ¥å£çš„`error`äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œè¯¥å…ƒç´ ä¸Šçš„`onerror`å¤„ç†å‡½æ•°ã€‚è¿™äº›`error`äº‹ä»¶ä¸ä¼šå‘ä¸Šå†’æ³¡åˆ°`window`ï¼Œ ä¸è¿‡ï¼ˆè‡³å°‘åœ¨ `Chrome` ä¸­ï¼‰èƒ½è¢«å•ä¸€çš„`window.addEventListener` æ•è·ã€‚

```js
<script>
window.addEventListener('error', (error) => {
 console.log('æ•è·åˆ°å¼‚å¸¸ï¼š', error);
}, true)
</script>
<img src="./xxxx.png">
```

å¯ä»¥æ•è·å¼‚å¸¸ï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjThicg6Mq5fOCEAHtKIFP0o5ZFWU7nPGvWAFlXbqdFoUPgxOvMbpzZHRCQLmSg7NvN5xcZCn3QXfw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

ç”±äºç½‘ç»œè¯·æ±‚å¼‚å¸¸ä¸ä¼šäº‹ä»¶å†’æ³¡ï¼Œå› æ­¤å¿…é¡»åœ¨æ•è·é˜¶æ®µå°†å…¶æ•æ‰åˆ°æ‰è¡Œï¼Œä½†æ˜¯è¿™ç§æ–¹å¼è™½ç„¶å¯ä»¥æ•æ‰åˆ°ç½‘ç»œè¯·æ±‚çš„å¼‚å¸¸ï¼Œä½†æ˜¯æ— æ³•åˆ¤æ–­ `HTTP` çš„çŠ¶æ€æ˜¯ `404` è¿˜æ˜¯å…¶ä»–æ¯”å¦‚ `500` ç­‰ç­‰ï¼Œæ‰€ä»¥è¿˜éœ€è¦é…åˆæœåŠ¡ç«¯æ—¥å¿—æ‰è¿›è¡Œæ’æŸ¥åˆ†ææ‰å¯ä»¥ã€‚

> æ³¨æ„ï¼š
>
> ä¸åŒæµè§ˆå™¨ä¸‹è¿”å›çš„ `error` å¯¹è±¡å¯èƒ½ä¸åŒï¼Œéœ€è¦æ³¨æ„å…¼å®¹å¤„ç†ã€‚
>
> éœ€è¦æ³¨æ„é¿å… `window.addEventListener` é‡å¤ç›‘å¬ã€‚

åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å­¦åˆ°äº†ï¼šåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºå®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œå¯ä»¥ä½¿ç”¨`try{}catch(){}`æ¥è¿›è¡Œé”™è¯¯çš„æ•è·ï¼Œåšå¥½å…œåº•å¤„ç†ï¼Œé¿å…é¡µé¢æŒ‚æ‰ã€‚è€Œå¯¹äºå…¨å±€çš„é”™è¯¯æ•è·ï¼Œåœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œæˆ‘å€¾å‘äºåªä½¿ç”¨ä½¿ç”¨`window.addEventListener('error')`ï¼Œ`window.addEventListener('unhandledrejection')`å°±è¡Œäº†ã€‚å¦‚æœéœ€è¦è€ƒè™‘å…¼å®¹æ€§ï¼Œéœ€è¦åŠ ä¸Š`window.onerror`ï¼Œä¸‰è€…åŒæ—¶ä½¿ç”¨ï¼Œ`window.addEventListener('error')`ä¸“é—¨ç”¨æ¥æ•è·èµ„æºåŠ è½½é”™è¯¯ã€‚



#### Promise Catch

æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ `promise` ä¸­ä½¿ç”¨ `catch` å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ•è·åˆ°å¼‚æ­¥ `error` ã€‚

æ²¡æœ‰å†™`catch`çš„`promise`ä¸­æŠ›å‡ºçš„é”™è¯¯æ— æ³•è¢«`onerror`æˆ–`try...catch`æ•è·åˆ°ï¼Œæ‰€ä»¥åŠ¡å¿…åœ¨`promise`ä¸­å†™`catch`åšå¼‚å¸¸å¤„ç†ã€‚

æœ‰æ²¡æœ‰ä¸€ä¸ªå…¨å±€æ•è·`promise`çš„å¼‚å¸¸å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ã€‚ `Uncaught Promise Error`å°±èƒ½åšåˆ°å…¨å±€ç›‘å¬ï¼Œä½¿ç”¨æ–¹å¼ï¼š

```js
window.addEventListener("unhandledrejection", function(e){
  // e.preventDefault(); // é˜»æ­¢å¼‚å¸¸å‘ä¸ŠæŠ›å‡º
  console.log('æ•è·åˆ°å¼‚å¸¸ï¼š', e);
});
Promise.reject('promise error');
```

åŒæ ·å¯ä»¥æ•è·é”™è¯¯ï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjThicg6Mq5fOCEAHtKIFP0oBst5ZVOmDkYFvgiaHA4Kz0CngFqChX7U7ITp2TIibS6fzf5f1DMhIpCA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

æ‰€ä»¥ï¼Œæ­£å¦‚æˆ‘ä»¬ä¸Šé¢æ‰€è¯´ï¼Œä¸ºäº†é˜²æ­¢æœ‰æ¼æ‰çš„ `promise` å¼‚å¸¸ï¼Œå»ºè®®åœ¨å…¨å±€å¢åŠ ä¸€ä¸ªå¯¹ `unhandledrejection` çš„ç›‘å¬ï¼Œç”¨æ¥å…¨å±€ç›‘å¬ `Uncaught Promise Error`ã€‚



#### iframe å¼‚å¸¸

å¯¹äº `iframe` çš„å¼‚å¸¸æ•è·ï¼Œæˆ‘ä»¬è¿˜å¾—å€ŸåŠ› `window.onerror`ï¼š

```js
window.onerror = function(message, source, lineno, colno, error) {
  console.log('æ•è·åˆ°å¼‚å¸¸ï¼š',{message, source, lineno, colno, error});
}
```

ä¸‹é¢ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```js
<iframe src="./iframe.html" frameborder="0"></iframe>
<script>
  window.frames[0].onerror = function (message, source, lineno, colno, error) {
    console.log('æ•è·åˆ° iframe å¼‚å¸¸ï¼š', {message, source, lineno, colno, error});
  };
</script>
```



#### Script error

åœ¨è¿›è¡Œé”™è¯¯æ•è·çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½æ‹¿åˆ°å®Œæ•´çš„é”™è¯¯ä¿¡æ¯ï¼Œå¾—åˆ°çš„ä»…ä»…æ˜¯ä¸€ä¸ª`"Script Error"`ã€‚

##### äº§ç”ŸåŸå› 

ç”±äº12å¹´å‰è¿™ç¯‡æ–‡ç« é‡Œæåˆ°çš„å®‰å…¨é—®é¢˜ï¼šhttps://blog.jeremiahgrossman.com/2006/12/i-know-if-youre-logged-in-anywhere.html**å½“åŠ è½½è‡ªä¸åŒåŸŸçš„è„šæœ¬ä¸­å‘ç”Ÿè¯­æ³•é”™è¯¯æ—¶ï¼Œä¸ºé¿å…ä¿¡æ¯æ³„éœ²ï¼Œè¯­æ³•é”™è¯¯çš„ç»†èŠ‚å°†ä¸ä¼šæŠ¥å‘Šï¼Œè€Œæ˜¯ä½¿ç”¨ç®€å•çš„****`"Script error."`ä»£æ›¿**ã€‚

ä¸€èˆ¬è€Œè¨€ï¼Œé¡µé¢çš„JSæ–‡ä»¶éƒ½æ˜¯æ”¾åœ¨CDNçš„ï¼Œå’Œé¡µé¢è‡ªèº«çš„URLäº§ç”Ÿäº†è·¨åŸŸé—®é¢˜ï¼Œæ‰€ä»¥å¼•èµ·äº†`"Script Error"`ã€‚

##### è§£å†³åŠæ³•

ä¸€èˆ¬æƒ…å†µï¼Œå¦‚æœå‡ºç° `Script error` è¿™æ ·çš„é”™è¯¯ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šæ˜¯è·¨åŸŸé—®é¢˜ã€‚è¿™æ—¶å€™ï¼Œæ˜¯ä¸ä¼šæœ‰å…¶ä»–å¤ªå¤šè¾…åŠ©ä¿¡æ¯çš„ï¼Œä½†æ˜¯è§£å†³æ€è·¯æ— éå¦‚ä¸‹ï¼š

è·¨æºèµ„æºå…±äº«æœºåˆ¶( `CORS` )ï¼šæˆ‘ä»¬ä¸º `script` æ ‡ç­¾æ·»åŠ  `crossOrigin` å±æ€§ã€‚

```js
<script src="http://jartto.wang/main.js" crossorigin></script>
```



#### å´©æºƒå’Œå¡é¡¿

å¡é¡¿ä¹Ÿå°±æ˜¯ç½‘é¡µæš‚æ—¶å“åº”æ¯”è¾ƒæ…¢ï¼Œ JSå¯èƒ½æ— æ³•åŠæ—¶æ‰§è¡Œã€‚ä½†å´©æºƒå°±ä¸ä¸€æ ·äº†ï¼Œç½‘é¡µéƒ½å´©æºƒäº†ï¼ŒJSéƒ½ä¸è¿è¡Œäº†ï¼Œè¿˜æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç›‘æ§ç½‘é¡µçš„å´©æºƒï¼Œå¹¶å°†ç½‘é¡µå´©æºƒä¸ŠæŠ¥å‘¢ï¼Ÿ

1.åˆ©ç”¨ `window` å¯¹è±¡çš„ `load` å’Œ `beforeunload` äº‹ä»¶å®ç°äº†ç½‘é¡µå´©æºƒçš„ç›‘æ§ã€‚
ä¸é”™çš„æ–‡ç« ï¼Œæ¨èé˜…è¯»ï¼šhttp://jasonjl.me/blog/2015/06/21/taking-action-on-browser-crashes/ã€‚

```js
window.addEventListener('load', function () {
    sessionStorage.setItem('good_exit', 'pending');
    setInterval(function () {
        sessionStorage.setItem('time_before_crash', new Date().toString());
    }, 1000);
  });

  window.addEventListener('beforeunload', function () {
    sessionStorage.setItem('good_exit', 'true');
  });

  if(sessionStorage.getItem('good_exit') &&
    sessionStorage.getItem('good_exit') !== 'true') {
    /*
        insert crash logging code here
    */
    alert('Hey, welcome back from your crash, looks like you crashed on: ' + sessionStorage.getItem('time_before_crash'));
  }
```

2.åŸºäºä»¥ä¸‹åŸå› ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Service Worker` æ¥å®ç°ç½‘é¡µå´©æºƒçš„ç›‘æ§ï¼š

2.1`Service Worker` æœ‰è‡ªå·±ç‹¬ç«‹çš„å·¥ä½œçº¿ç¨‹ï¼Œä¸ç½‘é¡µåŒºåˆ†å¼€ï¼Œç½‘é¡µå´©æºƒäº†ï¼Œ`Service Worker`ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå´©æºƒ

2.2`Service Worker` ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬è¦æ¯”ç½‘é¡µè¿˜è¦é•¿ï¼Œå¯ä»¥ç”¨æ¥ç›‘æ§ç½‘é¡µçš„çŠ¶æ€

2.3ç½‘é¡µå¯ä»¥é€šè¿‡ `navigator.serviceWorker.controller.postMessage API` å‘æŒç®¡è‡ªå·±çš„ `SW` å‘é€æ¶ˆæ¯



#### VUE errorHandler

åœ¨Vueä¸­ï¼Œå¼‚å¸¸å¯èƒ½è¢«Vueè‡ªèº«ç»™`try...catch`äº†ï¼Œä¸ä¼šä¼ åˆ°`window.onerror`äº‹ä»¶è§¦å‘ã€‚ä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼ŒVueæä¾›äº†ç‰¹æœ‰çš„å¼‚å¸¸æ•è·ï¼Œæ¯”å¦‚Vux2.xä¸­æˆ‘ä»¬å¯ä»¥è¿™æ ·ç”¨ï¼š

```js
Vue.config.errorHandler = function (err, vm, info) {
 let { 
     message, // å¼‚å¸¸ä¿¡æ¯
     name, // å¼‚å¸¸åç§°
     script,  // å¼‚å¸¸è„šæœ¬url
     line,  // å¼‚å¸¸è¡Œå·
     column,  // å¼‚å¸¸åˆ—å·
     stack  // å¼‚å¸¸å †æ ˆä¿¡æ¯
 } = err;
 
 // vmä¸ºæŠ›å‡ºå¼‚å¸¸çš„ Vue å®ä¾‹
 // infoä¸º Vue ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯æ‰€åœ¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­
}
```



#### React å¼‚å¸¸æ•è·

åœ¨Reactï¼Œå¯ä»¥ä½¿ç”¨`ErrorBoundary`ç»„ä»¶åŒ…æ‹¬ä¸šåŠ¡ç»„ä»¶çš„æ–¹å¼è¿›è¡Œå¼‚å¸¸æ•è·ï¼Œé…åˆ`React 16.0+`æ–°å‡ºçš„`componentDidCatch API`ï¼Œå¯ä»¥å®ç°ç»Ÿä¸€çš„å¼‚å¸¸æ•è·å’Œæ—¥å¿—ä¸ŠæŠ¥ã€‚

æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªå°ä¾‹å­ï¼Œåœ¨ä¸‹é¢è¿™ä¸ª `componentDIdCatch(error,info)` é‡Œçš„ç±»ä¼šå˜æˆä¸€ä¸ª `error boundary`ï¼š

```js
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }
 
  componentDidCatch(error, info) {
    // Display fallback UI
    this.setState({ hasError: true });
    // You can also log the error to an error reporting service
    logErrorToMyService(error, info);
  }
 
  render() {
    if (this.state.hasError) {
      // You can render any custom fallback UI
      return <h1>Something went wrong.</h1>;
    }
    return this.props.children;
  }
}
```

ç„¶åæˆ‘ä»¬åƒä½¿ç”¨æ™®é€šç»„ä»¶é‚£æ ·ä½¿ç”¨å®ƒï¼š

```js
<ErrorBoundary>  
 <MyWidget />
</ErrorBoundary>
```

`componentDidCatch()` æ–¹æ³•åƒJSçš„ `catch{}` æ¨¡å—ä¸€æ ·å·¥ä½œï¼Œä½†æ˜¯å¯¹äºç»„ä»¶ï¼Œåªæœ‰ `class` ç±»å‹çš„ç»„ä»¶(`class component` )å¯ä»¥æˆä¸ºä¸€ä¸ª `error boundaries` ã€‚

å®é™…ä¸Šï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥åœ¨æ•´ä¸ªç¨‹åºä¸­å®šä¹‰ä¸€ä¸ª `error boundary` ç»„ä»¶ï¼Œä¹‹åå°±å¯ä»¥ä¸€ç›´ä½¿ç”¨å®ƒäº†ï¼

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼š`error boundaries`å¹¶ä¸ä¼šæ•æ‰ä¸‹é¢è¿™äº›é”™è¯¯ï¼š
>
> \1. äº‹ä»¶å¤„ç†å™¨
>
> \2. å¼‚æ­¥ä»£ç 
>
> \3. æœåŠ¡ç«¯çš„æ¸²æŸ“ä»£ç 
>
> \4. åœ¨ `error boundaries` åŒºåŸŸå†…çš„é”™è¯¯

### æ€»ç»“

1. å¯ç–‘åŒºåŸŸå¢åŠ  `try...catch`
2. å…¨å±€ç›‘æ§JSå¼‚å¸¸ï¼š `window.onerror`
3. å…¨å±€ç›‘æ§é™æ€èµ„æºå¼‚å¸¸ï¼š `window.addEventListener`
4. å…¨å±€æ•è·æ²¡æœ‰ `catch` çš„ `promise` å¼‚å¸¸ï¼š`unhandledrejection`
5. iframe å¼‚å¸¸ï¼š`window.error`
6. `VUE errorHandler` å’Œ `React componentDidCatch`
7. ç›‘æ§ç½‘é¡µå´©æºƒï¼š`window` å¯¹è±¡çš„ `load` å’Œ `beforeunload`
8. `Script Error`è·¨åŸŸ `crossOrigin` è§£å†³

- æœ¬æ–‡ä½œè€…ï¼šå¥”è·‘çš„ç“œç‰›
- æœ¬æ–‡é“¾æ¥ï¼šhttps://www.cnblogs.com/chenwenhao/p/12184733.html